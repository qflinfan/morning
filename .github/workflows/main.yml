name: auto-checkin
on:
  schedule:
    - cron: '0 20 * * *'  # UTC时间20:00 → 北京时间04:00（可修改）
  workflow_dispatch:

jobs:
  checkin-job:
    runs-on: ubuntu-latest
    name: 自动签到任务

    steps:
      # 第一步：拉取仓库代码到运行环境（关键！必须加）
      - name: 拉取仓库代码
        uses: actions/checkout@v4  # 最新版本，确保能拉取代码

      - name: 配置Python环境
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'  # 稳定版本
          architecture: 'x64'

      - name: 安装依赖并执行签到
        run: |
          python -m pip install --upgrade pip
          pip install requests -i https://pypi.tuna.tsinghua.edu.cn/simple
          python main.py  # 现在能找到main.py了

    env:
      AUTH_TOKEN: ${{ secrets.AUTH_TOKEN }}
      CHECKIN_URL: "https://api-mi.xsot.cn/user/checkin"
